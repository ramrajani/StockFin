<% include partials/header.ejs %>
<% include partials/middle.ejs %>

<div class="container" style="  background: linear-gradient(to right, #2980b9, #6dd5fa, #2980b9);height:100%">
    
  <div class="row " style="padding-top:5%">
     <div class="col-md-1"></div>
        <div class="col-md-4 square" style="border: 2px solid #4e7e80;border-radius: 15%;background-color: #e6e6e8;">
                    <div style="padding-top:3%">                
                    <h2><strong style="color:#870000"> SENSEX:&nbsp;</strong><span id="marketcap"></span></h2>
                    <h4>
                    <div><span style="color:#0091EA"><strong>Open : </strong></span><span id="openprice" style="color:#4A148C"></span></div>
                        <div><span style="color:#0091EA"><strong>High : </strong></span><span id="highprice" style="color:#4A148C"></span></div>
                        <div><span style="color:#0091EA"><strong>Low : </strong></span><span id="lowprice" style="color:#4A148C"></span></div>
                        <div><span style="color:#0091EA"><strong>Volume :</strong></span><span id="volume" style="color:#4A148C"></span></div>
</h4>
                   </div>
              </div>
             <div class="col-md-1"></div>
              <div class="col-md-4 square" style="border: 2px solid #4e7e80;border-radius: 15%;   width: 100%;overflow: hidden;background-color: #e6e6e8;">
                  <div style="padding-top:3%; width: 100%;height: 100%;overflow-y: scroll; padding-right: 17px;box-sizing: content-box;" id="scrnews" >
                   <table  border="0" id="newsTable" style="text-color:white">
                <thead>
                <tr><th><h4><strong style="color:#870000">Breaking News</strong></h4></th></tr>
                </thead>
              
            </table>
                   </div>
                  </div>
                  

</div>
<div class="row"></div>
<div class="row"></div>
<div class="row" style="padding-top:10%">
    <div class="col-md-3">
        
    </div> 
     <div class="col-md-6">
         <form action="/analysis">
             <input type="submit" value="Search For Best Stock Here" class="btn btn-block" style="background: linear-gradient(to right, #cac531, #f3f9a7);font-size: 1.5rem;font-weight: 600">
         </form>
     </div>
    
</div>
</div>






<script>
   function sensexvalue(){
      $.ajax({
            url:"https://www.alphavantage.co/query?function=TIME_SERIES_DAILY_ADJUSTED&symbol=^BSESN&apikey=GXO2ZRA29LQ2BE78" ,
            type:"GET",
            dataType: 'json',
            data:{},
            success:function(data) {
                  console.log(data);
                  var str ="Series"
              for(key in data){
                    if(key.includes(str)){
                          console.log(data[key]);
                          var str1 = gettoday();
                          for(datee in data[key]){    
                             if(datee.includes(str1)){
                                   var val = data[key][datee];
                                   console.log(data[key][datee]);
                                   var str2="close";
                                   for(key in val){
                                         if(key.includes("4")){
                                               $('#marketcap').html(val[key]);
                                               console.log(val[key]);
                                         }
                                             if(key.includes("1")){
                                               $('#openprice').html(val[key]);
                                         }
                                         if(key.includes("2")){
                                               $('#highprice').html(val[key]);
                                         }
                                         if(key.includes("3")){
                                               $('#lowprice').html(val[key]);
                                         }
                                         if(key.includes("6")){
                                               $('#volume').html(val[key]);
                                         }
                                   }
                             }
                          }
                    }


              }
            
                            }
                                                     });

   }
sensexvalue();

setInterval(sensexvalue,100000);
function gettoday(){
    var today = new Date();
    var n = today.getHours();
    var p = today.getMinutes();
    var dd ="";
    console.log(n+" "+p);
    if(n<10){
       dd = today.getDate()-1;
    }else{
       dd = today.getDate();
    }
    var mm = today.getMonth()+1; //January is 0!
    var yyyy = today.getFullYear();
    
    if(dd<10) {
        dd = '0'+dd
    } 
    
    if(mm<10) {
        mm = '0'+mm
    } 
    var compdate = yyyy+"-"+mm+"-"+dd;
    console.log(compdate);
    return(compdate);
    



}

$.ajax({
            url:"https://newsapi.org/v2/top-headlines?country=in&category=business&apiKey=9233d93e3f414c119fbfaf44b8dc414b" ,
            type:"GET",
            dataType: 'json',
            data:{},
            success:function(data) {
                var array=data.articles;
                var newsdata="";
                   for( var i=0; i<array.length;++i){
                   console.log(array[i].title);
                     newsdata+='<li><a href="'+array[i].url+'">'+array[i].title+'</a></li>';

                  

                  }
                  $('#newsTable').append(newsdata);
            }

            });



</script>

<% include partials/footer.ejs %>